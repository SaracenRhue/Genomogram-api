# Genomegram API

Express Genomegram API is a RESTful API built with Node.js and Express, providing access to the USCS Genome Browser data.

## Features

- Access to species data.
- Access to gene data based on species.
- Access to gene variant data.
- Request throttling.
- CORS enabled.
- Logging and rotating logs.

## Installation

```bash
docker run -p 3000:3000 saracenrhue/genomogram-api
```

## Usage

All endpoints return a JSON object. Here are the available endpoints:

- Get a list of species:
  - `GET http://localhost:3000/species`
  - Optional query parameters: `name`, `db`, `page`, `pageSize`
  
  This endpoint retrieves species data. You can filter the results by providing `name` or `db` as query parameters. The `page` and `pageSize` parameters control the pagination, and by default, it returns the first 100 species.

- Get a list of genes for a specific species (:species == db e.g. hg38):
  - `GET http://localhost:3000/species/:species/genes`
  - Optional query parameters: `name`, `variantCount`, `page`, `pageSize`, `nameStartsWith`, `minVariantCount`, `maxVariantCount`
  `
  
  This endpoint retrieves genes of the specified species. The results can be filtered by `name` or `variantCount`. Use the `page` and `pageSize` parameters to control the pagination. By default, it returns the first 100 genes.

- Get all the information for a specific gene in a species:
  - `GET http://localhost:3000/species/:species/genes/:gene`

  This endpoint retrieves all the information for a specific gene in a species (db, species, name, variants).

### Query Parameters

- `name`: filter the results by the name of the species, gene, or variant.
- `nameStartsWith`: filter the results by the name of the species, gene, or variant that starts with the given string.
- `db`: filter the species by database name.
- `variantCount`: filter the genes by the count of variants.
- `minVariantCount`: filter the genes by the minimum count of variants.
- `maxVariantCount`: filter the genes by the maximum count of variants.
- `exonCount`: filter the variants by exon count.
- `page`: the page number for pagination (default is 1).
- `pageSize`: the number of results per page (default and max is 100).

All filters are optional, and multiple filters can be combined.

For example, to get the second page of genes for the db `hg38` (Human) with a variant count of exactly 10, you could make a GET request to `http://localhost:3000/species/hg38/genes?variantCount=10&page=2`.

### Health Check

To check if the API is running, make a GET request to `http://localhost:3000/health`. Here you can also see if the UCSC Genome Browser is reachable.

### Users

To connect the api to a mongoDB database, you can set the `MONGO_URI` environment variable. The db musst be named `Genomogram` and the collection `users`.
The user model is defined as follows:

```json
{
"_id": "648ef7a4565499c39bb70006", // autogenerated by mongoDB
"name": "User",
"uuid": "648ef7a4565499c39bb70006", // unique identifier
"points": 69,
"playedLevels": [ ],
"createdAt": "2023-06-18T12:25:07.781Z", // autogenerated
"updatedAt": "2023-06-18T12:25:08.382Z" // autogenerated
}
```

To get or modify user data, you can use the following endpoints:

#### 1. GET /users

Retrieves a list of users from the 'users' collection in the 'Genomogram' database.

- **URL:** <http://localhost:3000/users>
- **Method:** GET
- **URL Params:**
  - Optional:
    - `id=[ObjectId]`: Filters users by their unique id.
    - `name=[string]`: Filters users by their name.
    - `sortByPoints=[string]`: Determines the sort order of the users by points. Possible values: "asc" for ascending, "desc" for descending. If no value is provided, it defaults to ascending.
    - `page=[integer]`: The page number for results. If no value is provided, it defaults to page 1. Each page shows up to 100 users.
- **Success Response:**
  - **Code:** 200
  - **Content:** An array of user objects.

#### 2. PUT /users

Updates an existing user in the 'users' collection in the 'Genomogram' database. If the user does not exist, it creates a new user.

- **URL:** <http://localhost:3000/users>
- **Method:** PUT
- **Data Params:** The updated user data in JSON format:
  - `name=[string]`: The new name of the user.
  - `uuid=[string]`: The unique id of the user.
  - `points=[integer]`: The new points of the user.
  - `createdAt=[date]`: The date the user was created.
- **Success Response:**
  - **Code:** 200
  - **Content:** A summary of the update operation, including the number of users updated.

#### 3. DELETE /users/:uuid

Deletes a user from the 'users' collection in the 'Genomogram' database.

- **URL:** <http://localhost:3000/users/:uuid>
- **Method:** DELETE
- **URL Params:**
  - Required:
    - `uuid=[string]`: The unique id of the user to be deleted.
- **Success Response:**
  - **Code:** 200
  - **Content:** `{ message: 'User deleted successfully' }`
- **Error Response:**
  - **Code:** 404
  - **Content:** `{ message: 'User not found' }`

## Rate Limiting

The API is configured with rate limiting for all requests to prevent abuse. Currently, it's set to a maximum of 1000 requests per minute per IP.

## Log Access

Logs are stored in the `.logs` file. The logs are written to the console as well as the file. The log file only keeps the last 500 lines and rotates every 24 hours.
